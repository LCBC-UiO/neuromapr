<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Surface Geometry • neuromapr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Surface Geometry">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">neuromapr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/neuromapr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/null-models.html">Choosing and Using Null Models</a></li>
    <li><a class="dropdown-item" href="../articles/parcellation.html">Working with Parcellated Data</a></li>
    <li><a class="dropdown-item" href="../articles/surface-geometry.html">Surface Geometry</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lcbc-uio/neuromapr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Surface Geometry</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lcbc-uio/neuromapr/blob/main/vignettes/surface-geometry.Rmd" class="external-link"><code>vignettes/surface-geometry.Rmd</code></a></small>
      <div class="d-none name"><code>surface-geometry.Rmd</code></div>
    </div>

    
    
<p>The cortical surface is not flat. Two regions can be close in
Euclidean space—a straight line through the brain—yet far apart along
the cortical sheet. This distinction matters whenever distance drives an
analysis: computing spatial autocorrelation, selecting neighbours, or
estimating how much cortex a region actually covers.</p>
<p>neuromapr provides tools for working with triangular surface meshes:
building graphs, computing geodesic distances, calculating per-vertex
surface areas, and converting between neuroimaging file formats.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lcbc-uio/neuromapr" class="external-link">neuromapr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="surface-meshes">Surface meshes<a class="anchor" aria-label="anchor" href="#surface-meshes"></a>
</h2>
<p>A cortical surface mesh consists of two pieces:</p>
<ul>
<li>
<strong>Vertices</strong>: an n x 3 matrix of 3D coordinates, one
row per point on the surface.</li>
<li>
<strong>Faces</strong>: an m x 3 matrix of integer indices, each row
defining a triangle by referencing three vertices.</li>
</ul>
<p>Together they describe the geometry. We build a small mesh by hand to
make the examples concrete:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vertices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>  <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>  <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">0</span>,</span>
<span>  <span class="fl">1.5</span>, <span class="fl">1</span>, <span class="fl">0</span>,</span>
<span>  <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>,</span>
<span>  <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0</span></span>
<span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">faces</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>,</span>
<span>  <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>,</span>
<span>  <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">6</span>,</span>
<span>  <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span></span>
<span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Six vertices and four triangles forming a small irregular strip. Real
cortical surfaces have tens of thousands of vertices, but the operations
are the same.</p>
</div>
<div class="section level2">
<h2 id="building-a-surface-graph">Building a surface graph<a class="anchor" aria-label="anchor" href="#building-a-surface-graph"></a>
</h2>
<p><code><a href="../reference/make_surf_graph.html">make_surf_graph()</a></code> converts a mesh into a weighted igraph
object. Each edge connects two vertices that share a triangle, and the
weight is the Euclidean distance between them.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_surf_graph.html">make_surf_graph</a></span><span class="op">(</span><span class="va">vertices</span>, <span class="va">faces</span><span class="op">)</span></span>
<span><span class="va">g</span></span>
<span><span class="co">#&gt; IGRAPH fadb471 U-W- 6 9 -- </span></span>
<span><span class="co">#&gt; + attr: weight (e/n)</span></span>
<span><span class="co">#&gt; + edges from fadb471:</span></span>
<span><span class="co">#&gt; [1] 1--2 2--3 3--4 3--5 4--6 5--6 1--3 2--4 3--6</span></span></code></pre></div>
<p>The graph captures the connectivity structure of the mesh—which
vertices are adjacent and how far apart they are along the surface. It
is the foundation for geodesic distance computation.</p>
<p>Here is what the graph looks like, using the vertex positions as
layout coordinates. Edge labels show the Euclidean distance between
connected vertices:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layout_xy</span> <span class="op">&lt;-</span> <span class="va">vertices</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">edge_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span></span>
<span>  <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span>, <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">g</span>,</span>
<span>  layout <span class="op">=</span> <span class="va">layout_xy</span>,</span>
<span>  vertex.size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  vertex.color <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>  vertex.label.color <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  vertex.label.cex <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  edge.label <span class="op">=</span> <span class="va">edge_weights</span>,</span>
<span>  edge.label.cex <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  edge.color <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Surface mesh graph"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="surface-geometry_files/figure-html/igraph-plot-1.png" class="r-plt" alt="Surface graph of the toy mesh. Vertices are positioned at their x-y coordinates, edges are weighted by Euclidean distance." width="576"><p class="caption">
Surface graph of the toy mesh. Vertices are positioned at their x-y
coordinates, edges are weighted by Euclidean distance.
</p>
</div>
<p>On a real cortical surface, this graph has thousands of nodes and
edges. The structure is the same: vertices connected by triangle edges,
weights encoding surface distances.</p>
</div>
<div class="section level2">
<h2 id="geodesic-distances">Geodesic distances<a class="anchor" aria-label="anchor" href="#geodesic-distances"></a>
</h2>
<p>Euclidean distance is a straight line through 3D space. Geodesic
distance follows the surface, taking the shortest path along mesh edges.
For a convoluted surface like the cortex, the two can differ
substantially.</p>
<p><code><a href="../reference/get_surface_distance.html">get_surface_distance()</a></code> computes geodesic distances via
Dijkstra’s algorithm on the surface graph:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_surface_distance.html">get_surface_distance</a></span><span class="op">(</span><span class="va">vertices</span>, <span class="va">faces</span><span class="op">)</span></span>
<span><span class="va">dmat</span></span>
<span><span class="co">#&gt;          [,1]     [,2]     [,3]     [,4]     [,5]     [,6]</span></span>
<span><span class="co">#&gt; [1,] 0.000000 1.000000 1.118034 2.118034 2.236068 2.236068</span></span>
<span><span class="co">#&gt; [2,] 1.000000 0.000000 1.118034 1.118034 2.236068 2.236068</span></span>
<span><span class="co">#&gt; [3,] 1.118034 1.118034 0.000000 1.000000 1.118034 1.118034</span></span>
<span><span class="co">#&gt; [4,] 2.118034 1.118034 1.000000 0.000000 2.118034 1.118034</span></span>
<span><span class="co">#&gt; [5,] 2.236068 2.236068 1.118034 2.118034 0.000000 1.000000</span></span>
<span><span class="co">#&gt; [6,] 2.236068 2.236068 1.118034 1.118034 1.000000 0.000000</span></span></code></pre></div>
<p>The result is a symmetric n x n matrix of shortest-path
distances.</p>
<div class="section level3">
<h3 id="partial-distance-matrices">Partial distance matrices<a class="anchor" aria-label="anchor" href="#partial-distance-matrices"></a>
</h3>
<p>Computing the full n x n matrix gets expensive for large meshes. If
you only need distances from a subset of source vertices, pass them
explicitly:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmat_partial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_surface_distance.html">get_surface_distance</a></span><span class="op">(</span></span>
<span>  <span class="va">vertices</span>, <span class="va">faces</span>, source_vertices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dmat_partial</span></span>
<span><span class="co">#&gt;          [,1]     [,2]     [,3]     [,4]     [,5]     [,6]</span></span>
<span><span class="co">#&gt; [1,] 0.000000 1.000000 1.118034 2.118034 2.236068 2.236068</span></span>
<span><span class="co">#&gt; [2,] 2.236068 2.236068 1.118034 1.118034 1.000000 0.000000</span></span></code></pre></div>
<p>A 2 x 6 matrix: distances from vertices 1 and 6 to all six vertices.
For parcellation centroid computations and neighbourhood queries, this
selective approach saves considerable time.</p>
</div>
<div class="section level3">
<h3 id="euclidean-vs-geodesic">Euclidean vs geodesic<a class="anchor" aria-label="anchor" href="#euclidean-vs-geodesic"></a>
</h3>
<p>On a flat mesh the two distance measures coincide. On a folded
cortex, geodesic distances are always greater than or equal to
Euclidean, often substantially so for regions separated by a sulcus.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">euclid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">vertices</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">geodesic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_surface_distance.html">get_surface_distance</a></span><span class="op">(</span><span class="va">vertices</span>, <span class="va">faces</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">geodesic</span> <span class="op">-</span> <span class="va">euclid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3152584</span></span></code></pre></div>
<p>On our flat toy mesh the difference is zero. On real cortical
surfaces, it is not.</p>
</div>
</div>
<div class="section level2">
<h2 id="vertex-areas">Vertex areas<a class="anchor" aria-label="anchor" href="#vertex-areas"></a>
</h2>
<p>Each vertex on a surface mesh represents a patch of cortex. Knowing
its area matters for area-weighted averaging and for understanding how
much cortical surface a parcel covers.</p>
<p><code><a href="../reference/vertex_areas.html">vertex_areas()</a></code> distributes each triangle’s area equally
among its three vertices:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">areas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vertex_areas.html">vertex_areas</a></span><span class="op">(</span><span class="va">vertices</span>, <span class="va">faces</span><span class="op">)</span></span>
<span><span class="va">areas</span></span>
<span><span class="co">#&gt; [1] 0.1666667 0.3333333 0.6666667 0.3333333 0.1666667 0.3333333</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">areas</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>The total vertex area equals the total surface area of all triangles.
Corner vertices (part of fewer triangles) get less area than interior
vertices (shared by more triangles).</p>
<div class="section level3">
<h3 id="checking-the-geometry">Checking the geometry<a class="anchor" aria-label="anchor" href="#checking-the-geometry"></a>
</h3>
<p>A sanity check: compute triangle areas directly and verify they sum
to the same total.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tri_area</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">v</span>, <span class="va">f</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">v</span><span class="op">[</span><span class="va">f</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="op">]</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">v</span><span class="op">[</span><span class="va">f</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="op">]</span></span>
<span>  <span class="va">cc</span> <span class="op">&lt;-</span> <span class="va">v</span><span class="op">[</span><span class="va">f</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="op">]</span></span>
<span>  <span class="va">ab</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">-</span> <span class="va">a</span></span>
<span>  <span class="va">ac</span> <span class="op">&lt;-</span> <span class="va">cc</span> <span class="op">-</span> <span class="va">a</span></span>
<span>  <span class="va">cross</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">ab</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">ac</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">ab</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="va">ac</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="va">ab</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="va">ac</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">ab</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">ac</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>    <span class="va">ab</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">ac</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">ab</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">ac</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">cross</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">total_tri</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">faces</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu">tri_area</span><span class="op">(</span><span class="va">vertices</span>, <span class="va">faces</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">areas</span><span class="op">)</span>, <span class="va">total_tri</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="format-conversions">Format conversions<a class="anchor" aria-label="anchor" href="#format-conversions"></a>
</h2>
<p>Cortical surfaces come in many file formats. FreeSurfer uses its own
binary formats (<code>.annot</code> for parcellations,
<code>.curv</code>/<code>.thickness</code>/<code>.sulc</code> for
morphometry), while modern tools increasingly expect GIFTI. neuromapr
provides two conversion functions.</p>
<div class="section level3">
<h3 id="annotation-to-gifti">Annotation to GIFTI<a class="anchor" aria-label="anchor" href="#annotation-to-gifti"></a>
</h3>
<p><code><a href="../reference/annot_to_gifti.html">annot_to_gifti()</a></code> converts a FreeSurfer
<code>.annot</code> file (parcellation labels) to a GIFTI label
file:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/annot_to_gifti.html">annot_to_gifti</a></span><span class="op">(</span><span class="st">"lh.aparc.annot"</span>, <span class="st">"lh.aparc.label.gii"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="morphometry-to-gifti">Morphometry to GIFTI<a class="anchor" aria-label="anchor" href="#morphometry-to-gifti"></a>
</h3>
<p><code><a href="../reference/fsmorph_to_gifti.html">fsmorph_to_gifti()</a></code> converts FreeSurfer morphometry files
to GIFTI func files:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fsmorph_to_gifti.html">fsmorph_to_gifti</a></span><span class="op">(</span><span class="st">"lh.thickness"</span>, <span class="st">"lh.thickness.func.gii"</span><span class="op">)</span></span></code></pre></div>
<p>Both functions require the <strong>freesurferformats</strong> and
<strong>gifti</strong> packages. If no output path is given, they
replace the file extension automatically (<code>.annot</code> becomes
<code>.label.gii</code>, <code>.curv</code> becomes
<code>.func.gii</code>).</p>
</div>
</div>
<div class="section level2">
<h2 id="resampling-between-coordinate-spaces">Resampling between coordinate spaces<a class="anchor" aria-label="anchor" href="#resampling-between-coordinate-spaces"></a>
</h2>
<p>Brain maps from different studies often live in different coordinate
spaces (fsaverage vs fsLR) and at different mesh densities (32k vs
164k). Before you can compare them, they need to be in the same space at
the same resolution.</p>
<p><code><a href="../reference/transform_to_space.html">transform_to_space()</a></code> handles this resampling using
Connectome Workbench via the <strong>ciftiTools</strong> package:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transformed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transform_to_space.html">transform_to_space</a></span><span class="op">(</span></span>
<span>  <span class="st">"map.func.gii"</span>,</span>
<span>  target_space <span class="op">=</span> <span class="st">"fsLR"</span>,</span>
<span>  target_density <span class="op">=</span> <span class="st">"32k"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For pairwise comparisons, <code><a href="../reference/resample_images.html">resample_images()</a></code> aligns two
maps into a common space with a single call:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aligned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resample_images.html">resample_images</a></span><span class="op">(</span></span>
<span>  src <span class="op">=</span> <span class="st">"map_a.func.gii"</span>,</span>
<span>  trg <span class="op">=</span> <span class="st">"map_b.func.gii"</span>,</span>
<span>  src_space <span class="op">=</span> <span class="st">"fsaverage"</span>,</span>
<span>  trg_space <span class="op">=</span> <span class="st">"fsLR"</span>,</span>
<span>  strategy <span class="op">=</span> <span class="st">"transform_to_trg"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Four strategies are available:</p>
<ul>
<li>
<code>"downsample_only"</code> — both maps already share a
coordinate space; downsample the higher-density one.</li>
<li>
<code>"transform_to_src"</code> — bring the target into the source’s
space.</li>
<li>
<code>"transform_to_trg"</code> — bring the source into the target’s
space.</li>
<li>
<code>"transform_to_alt"</code> — bring both into a third space and
density.</li>
</ul>
<p>All resampling functions require Connectome Workbench
(<code>wb_command</code>). Use <code><a href="../reference/check_wb_command.html">check_wb_command()</a></code> to verify
it is installed and locatable:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_wb_command.html">check_wb_command</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="putting-it-together">Putting it together<a class="anchor" aria-label="anchor" href="#putting-it-together"></a>
</h2>
<p>A typical workflow that combines surface geometry with the rest of
neuromapr:</p>
<ol style="list-style-type: decimal">
<li>Load a surface mesh from a GIFTI <code>.surf.gii</code> file.</li>
<li>Compute geodesic distances between parcel centroids.</li>
<li>Feed that distance matrix into spatially-constrained null model
generation.</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centroids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parcel_centroids.html">get_parcel_centroids</a></span><span class="op">(</span></span>
<span>  <span class="va">vertices</span>, <span class="va">labels</span>, method <span class="op">=</span> <span class="st">"surface"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">distmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">centroids</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nulls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_nulls.html">generate_nulls</a></span><span class="op">(</span></span>
<span>  <span class="va">parcel_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"burt2020"</span>,</span>
<span>  distmat <span class="op">=</span> <span class="va">distmat</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For analyses where the distinction between Euclidean and geodesic
distance matters—highly folded cortex, parcels separated by deep
sulci—computing geodesic distances between centroids can produce more
accurate null models.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Markello RD, Hansen JY, Liu Z-Q, et al. (2022). neuromaps: structural
and functional interpretation of brain maps. <em>Nature Methods</em>,
19, 1472–1480. <a href="doi:10.1038/s41592-022-01625-w" class="uri">doi:10.1038/s41592-022-01625-w</a></p>
<p>Robinson EC, Jbabdi S, Glasser MF, et al. (2014). MSM: a new flexible
framework for Multimodal Surface Matching. <em>NeuroImage</em>, 100,
414–426. <a href="doi:10.1016/j.neuroimage.2014.07.033" class="uri">doi:10.1016/j.neuroimage.2014.07.033</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Athanasia Mo Mowinckel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
