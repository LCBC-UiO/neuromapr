<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with Parcellated Data • neuromapr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with Parcellated Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">neuromapr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/neuromapr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/null-models.html">Choosing and Using Null Models</a></li>
    <li><a class="dropdown-item" href="../articles/parcellation.html">Working with Parcellated Data</a></li>
    <li><a class="dropdown-item" href="../articles/surface-geometry.html">Surface Geometry</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lcbc-uio/neuromapr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Working with Parcellated Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lcbc-uio/neuromapr/blob/v0.2.0/vignettes/parcellation.Rmd" class="external-link"><code>vignettes/parcellation.Rmd</code></a></small>
      <div class="d-none name"><code>parcellation.Rmd</code></div>
    </div>

    
    
<p>Most brain imaging analyses eventually need to move between two
resolutions: vertex-level (one value per surface point, typically
32k–164k per hemisphere) and parcel-level (one value per brain region,
typically 50–400). A cortical thickness map is vertex-level. A table of
regional volumes from the Desikan-Killiany atlas is parcel-level.
Comparing the two requires converting one to match the other.</p>
<p>neuromapr provides tools for this conversion—aggregating vertices
into parcels, mapping parcel values back to vertices, and computing
parcel centroids on the cortical surface.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lcbc-uio/neuromapr" class="external-link">neuromapr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="vertices-to-parcels">Vertices to parcels<a class="anchor" aria-label="anchor" href="#vertices-to-parcels"></a>
</h2>
<p>Suppose you have a vertex-level brain map and a parcellation that
assigns each vertex to a region. The parcellation is an integer vector
where each vertex gets a label, with <code>0</code> or <code>NA</code>
marking the medial wall (vertices that belong to no region).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n_vertices</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">vertex_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_vertices</span><span class="op">)</span></span>
<span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="va">n_vertices</span>,</span>
<span>  replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.09</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">parcel_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vertices_to_parcels.html">vertices_to_parcels</a></span><span class="op">(</span><span class="va">vertex_data</span>, <span class="va">labels</span><span class="op">)</span></span>
<span><span class="va">parcel_values</span></span>
<span><span class="co">#&gt;            1            2            3            4            5            6 </span></span>
<span><span class="co">#&gt; -0.001235255  0.142132938 -0.055766033 -0.162060178  0.027356454 -0.019617141 </span></span>
<span><span class="co">#&gt;            7            8            9           10 </span></span>
<span><span class="co">#&gt; -0.114211335 -0.047980452 -0.108683119  0.018359997</span></span></code></pre></div>
<p>Each parcel gets the mean of its constituent vertices. Medial wall
vertices (label 0) are excluded automatically.</p>
<p>The summary function is configurable:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parcel_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vertices_to_parcels.html">vertices_to_parcels</a></span><span class="op">(</span></span>
<span>  <span class="va">vertex_data</span>, <span class="va">labels</span>, summary_func <span class="op">=</span> <span class="va">sd</span></span>
<span><span class="op">)</span></span>
<span><span class="va">parcel_sd</span></span>
<span><span class="co">#&gt;         1         2         3         4         5         6         7         8 </span></span>
<span><span class="co">#&gt; 1.0683513 1.0550975 0.9958556 1.0257398 1.0019210 0.8117328 0.9765293 1.0108265 </span></span>
<span><span class="co">#&gt;         9        10 </span></span>
<span><span class="co">#&gt; 1.0698179 0.9825964</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parcels-back-to-vertices">Parcels back to vertices<a class="anchor" aria-label="anchor" href="#parcels-back-to-vertices"></a>
</h2>
<p>The reverse operation paints parcel-level values back onto the vertex
mesh. Every vertex gets its parcel’s value; medial wall vertices get a
fill value.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vertex_filled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parcels_to_vertices.html">parcels_to_vertices</a></span><span class="op">(</span><span class="va">parcel_values</span>, <span class="va">labels</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">vertex_filled</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] -0.001235255  0.027356454 -0.047980452  0.018359997  0.018359997</span></span>
<span><span class="co">#&gt;  [6] -0.108683119 -0.047980452  0.018359997  0.142132938 -0.162060178</span></span>
<span><span class="co">#&gt; [11] -0.114211335  0.142132938 -0.055766033 -0.047980452           NA</span></span>
<span><span class="co">#&gt; [16] -0.108683119 -0.114211335 -0.047980452 -0.108683119 -0.001235255</span></span></code></pre></div>
<p>Vertices with label 0 receive <code>NA</code> by default. You can
change the fill:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vertex_filled_zero</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parcels_to_vertices.html">parcels_to_vertices</a></span><span class="op">(</span></span>
<span>  <span class="va">parcel_values</span>, <span class="va">labels</span>, fill <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">vertex_filled_zero</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 95</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-high-level-wrappers">The high-level wrappers<a class="anchor" aria-label="anchor" href="#the-high-level-wrappers"></a>
</h2>
<p><code><a href="../reference/parcellate.html">parcellate()</a></code> and <code><a href="../reference/unparcellate.html">unparcellate()</a></code> add
file-reading convenience on top of the low-level functions. If your data
lives on disk as GIFTI files, pass paths directly:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parcel_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parcellate.html">parcellate</a></span><span class="op">(</span></span>
<span>  <span class="st">"cortical_thickness.func.gii"</span>,</span>
<span>  <span class="st">"aparc.label.gii"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The function reads the data file, reads the parcellation labels,
validates that they match in length, and calls
<code><a href="../reference/vertices_to_parcels.html">vertices_to_parcels()</a></code> underneath.</p>
<p>When working with vectors already in memory, the wrappers still
work—they skip the file-reading step:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parcellated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parcellate.html">parcellate</a></span><span class="op">(</span><span class="va">vertex_data</span>, <span class="va">labels</span><span class="op">)</span></span>
<span><span class="va">unparcellated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unparcellate.html">unparcellate</a></span><span class="op">(</span><span class="va">parcellated</span>, <span class="va">labels</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/parcels_to_vertices.html">parcels_to_vertices</a></span><span class="op">(</span><span class="va">parcel_values</span>, <span class="va">labels</span><span class="op">)</span>,</span>
<span>  <span class="va">unparcellated</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The roundtrip is not lossless—parcellation is lossy aggregation. But
<code>unparcellate(parcellate(x))</code> gives you parcel means
broadcast back to vertex positions, which is the expected behaviour.</p>
</div>
<div class="section level2">
<h2 id="parcel-centroids">Parcel centroids<a class="anchor" aria-label="anchor" href="#parcel-centroids"></a>
</h2>
<p>Some analyses need to know where each parcel lives in 3D space—for
example, to compute a parcel-level distance matrix.
<code><a href="../reference/get_parcel_centroids.html">get_parcel_centroids()</a></code> offers three methods for finding the
representative point of each parcel.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vertices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_vertices</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="average-centroid">Average centroid<a class="anchor" aria-label="anchor" href="#average-centroid"></a>
</h3>
<p>Take the mean x, y, z coordinates of all vertices in the parcel.
Fast, but the resulting point may not lie on the actual cortical
surface.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centroids_avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parcel_centroids.html">get_parcel_centroids</a></span><span class="op">(</span></span>
<span>  <span class="va">vertices</span>, <span class="va">labels</span>, method <span class="op">=</span> <span class="st">"average"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">centroids_avg</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]         [,2]         [,3]</span></span>
<span><span class="co">#&gt; 1  0.11396575  0.016773018 -0.065814398</span></span>
<span><span class="co">#&gt; 2  0.02388696 -0.035682772 -0.020913744</span></span>
<span><span class="co">#&gt; 3  0.07952778  0.101717196  0.091118296</span></span>
<span><span class="co">#&gt; 4 -0.08853466 -0.052836153 -0.058780127</span></span>
<span><span class="co">#&gt; 5  0.01771226  0.044216347  0.046963635</span></span>
<span><span class="co">#&gt; 6 -0.03578315 -0.004064188 -0.008321535</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="surface-centroid">Surface centroid<a class="anchor" aria-label="anchor" href="#surface-centroid"></a>
</h3>
<p>Find the vertex closest to the average centroid. The result is always
an actual vertex on the surface, which matters when centroids must
respect the cortical geometry.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centroids_surf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parcel_centroids.html">get_parcel_centroids</a></span><span class="op">(</span></span>
<span>  <span class="va">vertices</span>, <span class="va">labels</span>, method <span class="op">=</span> <span class="st">"surface"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">centroids_surf</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]        [,2]       [,3]</span></span>
<span><span class="co">#&gt; 1 -0.08089878  0.26659246  0.1365766</span></span>
<span><span class="co">#&gt; 2 -0.12375518 -0.01086631  0.1036001</span></span>
<span><span class="co">#&gt; 3  0.38467702 -0.10467462 -0.1120929</span></span>
<span><span class="co">#&gt; 4 -0.58301662  0.13731157 -0.1416120</span></span>
<span><span class="co">#&gt; 5 -0.40958087  0.15919765 -0.1902452</span></span>
<span><span class="co">#&gt; 6 -0.47109369 -0.34759792  0.1752621</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="geodesic-centroid">Geodesic centroid<a class="anchor" aria-label="anchor" href="#geodesic-centroid"></a>
</h3>
<p>The most principled approach: find the vertex that minimizes the sum
of geodesic (shortest-path-on-surface) distances to all other vertices
in the parcel. This requires the face matrix of the surface mesh and the
<strong>igraph</strong> package.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centroids_geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parcel_centroids.html">get_parcel_centroids</a></span><span class="op">(</span></span>
<span>  <span class="va">vertices</span>, <span class="va">labels</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"geodesic"</span>,</span>
<span>  faces <span class="op">=</span> <span class="va">faces</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Geodesic centroids are computationally expensive—they compute
pairwise shortest paths within each parcel. For large parcellations on
high-resolution meshes, the surface centroid is a practical
approximation.</p>
</div>
</div>
<div class="section level2">
<h2 id="building-a-parcel-level-distance-matrix">Building a parcel-level distance matrix<a class="anchor" aria-label="anchor" href="#building-a-parcel-level-distance-matrix"></a>
</h2>
<p>A common use case: you have parcellated data and need a distance
matrix for null model generation. Parcel centroids get you there.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parcel_distmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">centroids_avg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">parcel_distmat</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10 10</span></span></code></pre></div>
<p>This distance matrix feeds directly into
<code><a href="../reference/generate_nulls.html">generate_nulls()</a></code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parcel_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">centroids_avg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nulls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_nulls.html">generate_nulls</a></span><span class="op">(</span></span>
<span>  <span class="va">parcel_map</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"moran"</span>,</span>
<span>  distmat <span class="op">=</span> <span class="va">parcel_distmat</span>,</span>
<span>  n_perm <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nulls</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Null Distribution</span></span>
<span><span class="co">#&gt; • Method: moran</span></span>
<span><span class="co">#&gt; • Permutations: 100</span></span>
<span><span class="co">#&gt; • Observations: 10</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parcellation-and-null-models-together">Parcellation and null models together<a class="anchor" aria-label="anchor" href="#parcellation-and-null-models-together"></a>
</h2>
<p>The parcel spin methods (<code>baum</code> and
<code>cornblath</code>) combine parcellation with spin-based null
generation. They need both spherical coordinates and the parcellation
vector:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_lh</span> <span class="op">&lt;-</span> <span class="fl">680</span></span>
<span><span class="va">n_rh</span> <span class="op">&lt;-</span> <span class="fl">680</span></span>
<span><span class="va">sphere_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  lh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_lh</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  rh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_rh</span> <span class="op">*</span> <span class="fl">3</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">parcellation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">68</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">parcel_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">68</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nulls_baum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/null_baum.html">null_baum</a></span><span class="op">(</span></span>
<span>  <span class="va">parcel_data</span>, <span class="va">sphere_coords</span>, <span class="va">parcellation</span>,</span>
<span>  n_perm <span class="op">=</span> <span class="fl">50L</span>, seed <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nulls_baum</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Null Distribution</span></span>
<span><span class="co">#&gt; • Method: baum</span></span>
<span><span class="co">#&gt; • Permutations: 50</span></span>
<span><span class="co">#&gt; • Observations: 68</span></span></code></pre></div>
<p>The rotation happens at vertex resolution, but the output is
parcel-level: one surrogate value per parcel per permutation. This is
the right approach when your analysis variable is measured at the parcel
level but you want the null model to respect vertex-level spatial
structure.</p>
</div>
<div class="section level2">
<h2 id="practical-considerations">Practical considerations<a class="anchor" aria-label="anchor" href="#practical-considerations"></a>
</h2>
<p><strong>Parcellation size matters for null models.</strong> With
30–50 parcels, distance-based methods like <code>burt2020</code> and
<code>moran</code> work well. With hundreds of parcels (e.g., Schaefer
400), spin-based methods become more attractive because they leverage
the full vertex-level spatial structure.</p>
<p><strong>Medial wall handling.</strong> All parcellation functions
treat label 0 and <code>NA</code> as medial wall. The
<code>cornblath</code> null model handles medial wall vertices
gracefully during spin-based reassignment. If your parcellation has
substantial medial wall coverage, prefer <code>cornblath</code> over
<code>baum</code>.</p>
<p><strong>The summary function determines what you are
testing.</strong> Using <code>mean</code> (the default) tests whether
the average value in each region relates to another variable. Using
<code>sd</code> would test whether within-region variability relates to
it. Choose deliberately.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Markello RD, Hansen JY, Liu Z-Q, et al. (2022). neuromaps: structural
and functional interpretation of brain maps. <em>Nature Methods</em>,
19, 1472–1480. <a href="doi:10.1038/s41592-022-01625-w" class="uri">doi:10.1038/s41592-022-01625-w</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Athanasia Mo Mowinckel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
